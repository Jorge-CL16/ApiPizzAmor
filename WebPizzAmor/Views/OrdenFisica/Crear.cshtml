@model WebPizzAmor.Models.OrdenFisicaViewModel
@{
    ViewData["Title"] = "Crear Orden Fisca";
}



<div class="container mt-4">
    <h2 class="text-center mb-4">Sistema de Caja - PizzAmor</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    <form asp-action="Crear" method="post" id="ordenForm">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="IdEmpleado">Empleado *</label>
                    <select asp-for="IdEmpleado" class="form-control" required>
                        <option value="">Seleccione empleado</option>
                        @foreach (var empleado in Model.Empleados)
                        {
                            <option value="@empleado.Value">@empleado.Text</option>
                        }
                    </select>
                    <span asp-validation-for="IdEmpleado" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="SaborIngredientes">Sabor de Pizza *</label>
                    <select asp-for="SaborIngredientes" class="form-control" id="saborPizza" required>
                        <option value="">Seleccione sabor</option>
                        <option value="Margarita">Margarita</option>
                        <option value="Hawaiana">Hawaiana (+$10)</option>
                        <option value="Peperoni">Peperoni (+$15)</option>
                        <option value="Vegetariana">Vegetariana</option>
                    </select>
                    <span asp-validation-for="SaborIngredientes" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="TamanioPizza">Tamaño *</label>
                    <select asp-for="TamanioPizza" class="form-control" id="tamanioPizza" required>
                        <option value="Pequeña">Pequeña ($50)</option>
                        <option value="Mediana">Mediana ($75)</option>
                        <option value="Grande">Grande ($100)</option>
                    </select>
                    <span asp-validation-for="TamanioPizza" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="IdRefresco">Refresco *</label>
                    <select asp-for="IdRefresco" class="form-control" id="refresco" required>
                        <option value="">Seleccione refresco</option>
                        @foreach (var refresco in Model.Refrescos)
                        {
                            <option value="@refresco.Value" data-precio="@refresco.Text.Split('$')[1].Split(')')[0]">@refresco.Text</option>
                        }
                    </select>
                    <span asp-validation-for="IdRefresco" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Total a Pagar</h5>
                        <h3 class="text-success">$<span id="montoTotal">@Model.MontoTotal.ToString("0.00")</span></h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-cash-register"></i> Registrar Orden
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#saborPizza, #tamanioPizza, #refresco').change(function() {
                calcularTotal();
            });

            function calcularTotal() {
                let total = 0;

                switch ($('#tamanioPizza').val()) {
                    case 'Pequeña': total += 50; break;
                    case 'Mediana': total += 75; break;
                    case 'Grande': total += 100; break;
                }

                switch ($('#saborPizza').val()) {
                    case 'Hawaiana': total += 10; break;
                    case 'Peperoni': total += 15; break;
                }

                const refrescoSeleccionado = $('#refresco option:selected');
                if (refrescoSeleccionado.val() !== "") {
                    total += parseFloat(refrescoSeleccionado.data('precio')) || 0;
                }

                $('#montoTotal').text(total.toFixed(2));
            }
        });
    </script>
}